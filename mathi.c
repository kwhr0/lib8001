#include "mathi.h"

s8 sini(u8 t) {
	static const s8 tbl[] = {
		0x00, 0x03, 0x06, 0x09, 0x0c, 0x10, 0x13, 0x16, 
		0x19, 0x1c, 0x1f, 0x22, 0x25, 0x28, 0x2b, 0x2e, 
		0x31, 0x33, 0x36, 0x39, 0x3c, 0x3f, 0x41, 0x44, 
		0x47, 0x49, 0x4c, 0x4e, 0x51, 0x53, 0x55, 0x58, 
		0x5a, 0x5c, 0x5e, 0x60, 0x62, 0x64, 0x66, 0x68, 
		0x6a, 0x6b, 0x6d, 0x6f, 0x70, 0x71, 0x73, 0x74, 
		0x75, 0x76, 0x78, 0x79, 0x7a, 0x7a, 0x7b, 0x7c, 
		0x7d, 0x7d, 0x7e, 0x7e, 0x7e, 0x7f, 0x7f, 0x7f, 
		0x7f
	};
	return t < 0x40 ? tbl[t] : t < 0x80 ? tbl[0x80 - t] : t < 0xc0 ?  -tbl[t - 0x80] : -tbl[0x100 - t];
}

s8 cosi(u8 t) {
	return sini(t + 0x40);
}

u8 atni(s16 dx, s16 dy) {
	static const u8 t[] = {
		0, 3, 5, 8, 10, 12, 15, 17, 19, 21, 23, 25, 26, 28, 29, 31, 32
	};
	static const u8 c[] = {
		0x00, 0x40, 0x00, 0xc0, 0x80, 0x40, 0x80, 0xc0
	};
	if (!dx && !dy) return 0;
	s16 ax = dx, ay = dy;
	if (ax < 0) ax = -ax;
	if (ay < 0) ay = -ay;
	u8 v = ax < ay ? t[((ax << 4) + 8) / ay] : t[((ay << 4) + 8) / ax];
	if (dx < 0 ^ dy < 0 ^ ax < ay) v = -v;
	return c[(dx < 0) << 2 | (dy < 0) << 1 | ax < ay] + v;
}

u8 sqrti(u16 x) {
	u16 t = x;
	s8 i = 0;
	u8 a = 0, c = 0, y = 0;
	while (t >>= 1) i++;
	for (i += i & 1; i >= 0; i -= 2) {
		c = (y << 1 | 1) <= x >> i;
		a = a << 1 | c;
		y = y << 1 | c;
		x -= c * y << i;
		y += c;
	}
	return a;
}
